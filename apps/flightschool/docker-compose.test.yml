version: '3.8'

services:
  flightschool-test:
    image: flightschool:test
    build:
      context: .
      dockerfile: ${DOCKERFILE:-Dockerfile}
      target: testing
      args:
        PYTHON_VERSION: ${PYTHON_VERSION:-3.11}
    environment:
      - FLASK_ENV=testing
      - FLASK_DEBUG=0
      - PYTHONPATH=/app
      - DATABASE_URL=sqlite:///:memory:
    command: ["pytest", "tests/", "-v", "--tb=short"]
    volumes:
      - ./app:/app/app
      - ./tests:/app/tests
      - ./config.py:/app/config.py
