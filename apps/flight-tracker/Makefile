# Flight Tracker Makefile
# Real-time flight tracking service (TypeScript/Node.js)

.PHONY: help install build start stop clean test lint docker-build docker-up docker-down docker-test test-docker docker-logs

PORT ?= 3001

help:
	@echo "Flight Tracker - Available Commands:"
	@echo ""
	@echo "Local Development:"
	@echo "  make start         - Install dependencies, build, and start the service"
	@echo "  make install       - Install Node.js dependencies"
	@echo "  make build         - Build TypeScript to JavaScript"
	@echo "  make stop          - Stop the running service"
	@echo "  make clean         - Remove all build artifacts and dependencies"
	@echo "  make test          - Run tests locally"
	@echo "  make lint          - Run linting checks"
	@echo ""
	@echo "Docker Commands:"
	@echo "  make docker-build  - Build Docker image"
	@echo "  make docker-up     - Start service in Docker"
	@echo "  make docker-down   - Stop and remove Docker containers"
	@echo "  make docker-test   - Run tests in Docker (recommended)"
	@echo "  make docker-logs   - View Docker container logs"
	@echo ""
	@echo "Port Configuration:"
	@echo "  PORT = $(PORT) (Service port)"
	@echo ""
	@echo "Usage:"
	@echo "  make start                    # Start on default port $(PORT)"
	@echo "  PORT=4001 make start          # Start on custom port"

install:
	@echo "ğŸ“¦ Installing dependencies for Flight Tracker..."
	npm install
	@echo "âœ… Dependencies installed!"

build: install
	@echo "ğŸ”¨ Building Flight Tracker..."
	npm run build
	@echo "âœ… Build complete!"

start: build
	@echo "ğŸš€ Starting Flight Tracker on port $(PORT)..."
	@echo ""
	@echo "ğŸŒ Service: http://localhost:$(PORT)"
	@echo ""
	@echo "Press Ctrl+C to stop the service"
	PORT=$(PORT) npm start

stop:
	@echo "ğŸ›‘ Stopping Flight Tracker..."
	@pkill -f "node.*flight-tracker" || true
	@echo "âœ… Service stopped!"

clean:
	@echo "ğŸ§¹ Cleaning Flight Tracker..."
	rm -rf node_modules
	rm -rf dist
	rm -f tsconfig.tsbuildinfo
	@echo "âœ… Cleanup complete!"

test:
	@echo "ğŸ§ª Running Flight Tracker tests..."
	npm test
	@echo "âœ… Tests complete!"

lint:
	@echo "ğŸ” Running Flight Tracker linting..."
	npm run lint
	@echo "âœ… Linting complete!"

# Docker targets
docker-build:
	docker-compose build

docker-up:
	docker-compose up -d
	@echo "âœ… Flight Tracker started in Docker!"
	@echo "ğŸš€ Service: http://localhost:$(PORT)"

docker-down:
	docker-compose down

docker-test: test-docker

test-docker:
	@echo "ğŸ§ª Running tests in Docker..."
	docker-compose -f docker-compose.test.yml up --build --abort-on-container-exit
	docker-compose -f docker-compose.test.yml down -v

docker-logs:
	docker-compose logs -f
